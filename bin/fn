#!/usr/bin/env bash

fd_command() {
  fd \
    --type d \
    --max-depth 3 \
    --exclude node_modules \
    --exclude public \
    --exclude src \
    --exclude target \
    . \
    "$HOME" \
    "/run/media/$USER"
}

INITIAL_QUERY="${*:-}"
fzf_command() {
  fzf \
    --prompt="‚ùØ " \
    --gutter=" " \
    --header-border \
    --input-border \
    --input-label " folders " \
    --list-border \
    --info=hidden \
    --reverse \
    --multi \
    --bind='enter:execute-silent(setsid -f nautilus {+})+abort' \
    --bind='alt-m:execute-silent(setsid -f fd -tf . {+} -X mpv --shuffle --loop-playlist=inf)+abort' \
    --bind=alt-p:toggle-preview \
    --bind='alt-r:change-preview-window(down|right)' \
    --preview="fzf-preview {}" \
    --preview-window=right \
    --color=input-border:blue \
    --query="$INITIAL_QUERY"
}

fd_command | fzf_command; exit
